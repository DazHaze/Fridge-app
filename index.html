<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Darragh's Fridge</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
      // Restore path from GitHub Pages 404 redirect
      // This MUST run synchronously before React Router initializes
      (function() {
        var redirectPath = sessionStorage.getItem('githubPagesRedirect');
        if (redirectPath) {
          sessionStorage.removeItem('githubPagesRedirect');
          
          // Always use /Fridge-app/ as the base path (matches vite.config.ts)
          var basePath = '/Fridge-app/';
          
          // Ensure the redirect path includes the base path
          var routerPath = redirectPath;
          
          // Check if path already has base path prefix
          var hasBasePath = routerPath.startsWith('/Fridge-app/') || routerPath.startsWith('/fridge-app/');
          
          if (!hasBasePath) {
            // Path doesn't have base path, prepend it
            // Remove leading slash if present to avoid double slashes
            routerPath = basePath + routerPath.replace(/^\//, '');
          } else {
            // Normalize casing to match basePath
            if (routerPath.startsWith('/fridge-app/')) {
              routerPath = routerPath.replace('/fridge-app/', '/Fridge-app/');
            }
          }
          
          // Ensure router path starts with /
          if (!routerPath.startsWith('/')) {
            routerPath = '/' + routerPath;
          }
          
          // Immediately replace the URL before React Router loads
          // Use replaceState to avoid adding to history and prevent reload
          // This must happen synchronously before any React code runs
          window.history.replaceState(null, '', routerPath);
          
          // Force update location object properties
          if (window.location.pathname !== routerPath.split('?')[0].split('#')[0]) {
            // If replaceState didn't work, try again after a microtask
            Promise.resolve().then(function() {
              window.history.replaceState(null, '', routerPath);
            });
          }
        }
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
